<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="description" content="YouTubeã‚’é€†å†ç”Ÿã§ãã‚‹ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã€‚é€Ÿåº¦èª¿æ•´ã‚„ãƒ«ãƒ¼ãƒ—å†ç”Ÿã«ã‚‚å¯¾å¿œã€‚">
<meta name="keywords" content="YouTube, é€†å†ç”Ÿ, Reverse Player, å‹•ç”»å†ç”Ÿ, å‹•ç”»ç·¨é›†">
<meta name="robots" content="index, follow">
<title>YouTube Flip Player</title>
<style>
  body{font-family:system-ui, -apple-system, "Hiragino Kaku Gothic ProN","Yu Gothic","ãƒ¡ã‚¤ãƒªã‚ª",sans-serif; padding:20px; background:#f6f7fb; color:#111}
  .container{max-width:980px;margin:0 auto}
  label{display:inline-block;margin-right:10px}
  input[type=text]{width:60%;padding:8px;font-size:14px}
  button, select{padding:8px 12px;margin-left:6px;font-size:14px}
  .player-wrap{margin-top:18px; width:100%; height:540px; background:#000; display:flex; align-items:center; justify-content:center; overflow:hidden}
  .iframe-box{width:100%; height:100%; transform-origin:center center;}
  .controls{margin-top:12px; display:flex; gap:10px; align-items:center; flex-wrap:wrap}
  .slider{width:60%}
  .small{font-size:13px}
  .note{margin-top:14px;color:#555}
  .speed-active{font-weight:700;margin-left:8px}
  .preset-item{background:#fff;border:1px solid #ddd;padding:10px;margin:8px 0;border-radius:4px;display:flex;justify-content:space-between;align-items:center}
  .preset-info{flex:1}
  .preset-info-title{font-weight:600;margin-bottom:4px}
  .preset-info-details{font-size:12px;color:#666}
  .preset-actions{display:flex;gap:6px}
  .preset-actions button{padding:4px 8px;font-size:12px}
  .mirror-active{background-color:#696969;color:#fff}
  /* small responsive */
  @media(max-width:720px){ input[type=text]{width:100%} .slider{width:100%} }
</style>
</head>
<body>
  <div class="container">
    <h1>YouTube åè»¢ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼</h1>
    <p>ä½¿ã„æ–¹: YouTubeã®å‹•ç”»URLã‚’è²¼ã£ã¦ã€Œèª­ã¿è¾¼ã‚€ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚åŒºé–“ãƒ«ãƒ¼ãƒ—ã¯ç§’æ•°ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ä½¿ç”¨ã§ãã¾ã™ã€‚</p>

    <div>
      <label>å‹•ç”»ãƒªãƒ³ã‚¯/ID</label>
      <input id="urlInput" type="text" placeholder="https://www.youtube.com/watch?v=VIDEO_ID ãªã©" />
      <button id="loadBtn">èª­ã¿è¾¼ã‚€</button>
      <button id="unloadBtn">èª­ã¿è¾¼ã¿è§£é™¤</button>
    </div>

    <div class="player-wrap">
      <div id="iframeBox" class="iframe-box"></div>
    </div>

    <div class="controls">
      <button id="playPauseBtn">â–¶ å†ç”Ÿ</button>
      <button id="reverseBtn">âª é€†å†ç”Ÿ</button>
      <button id="mirrorBtn">å·¦å³åè»¢</button>

      <label class="small">ãƒ«ãƒ¼ãƒ—:
        <input id="loopChk" type="checkbox" />
      </label>

      <label class="small">é€Ÿåº¦:
        <select id="speedSelect"></select>
        <span id="speedActive" class="speed-active">1.00x</span>
      </label>

      <label class="small">å†ç”Ÿä½ç½®:
        <input id="posSlider" class="slider" type="range" min="0" max="100" value="0" />
      </label>

      <span id="timeLabel" class="small">0:00 / 0:00</span>
    </div>

    <div class="controls" style="margin-top:8px;">
      <label class="small">å§‹ã¾ã‚Š:
        <input id="pointA" type="text" placeholder="0:00" style="width:70px" />
        <button id="setAFromCurrent" title="ç¾åœ¨ã®å†ç”Ÿä½ç½®ã‚’å§‹ã¾ã‚Šã«è¨­å®š">â†©</button>
      </label>
      <label class="small">çµ‚ã‚ã‚Š:
        <input id="pointB" type="text" placeholder="0:00" style="width:70px" />
        <button id="setBFromCurrent" title="ç¾åœ¨ã®å†ç”Ÿä½ç½®ã‚’çµ‚ã‚ã‚Šã«è¨­å®š">â†©</button>
      </label>
      <button id="setAB">åŒºé–“ãƒ«ãƒ¼ãƒ—é–‹å§‹</button>
      <button id="clearAB">åŒºé–“ãƒ«ãƒ¼ãƒ—è§£é™¤</button>
    </div>

    <div class="controls" style="margin-top:12px; border-top:1px solid #ccc; padding-top:12px;">
      <label class="small">è¨­å®šå:
        <input id="presetName" type="text" placeholder="è¨­å®šã®åå‰ã‚’å…¥åŠ›" style="width:150px" />
      </label>
      <button id="savePresetBtn">ğŸ’¾ è¨­å®šã‚’ä¿å­˜</button>
      <button id="clearPresetsBtn">ğŸ—‘ï¸ å…¨ã¦å‰Šé™¤</button>
    </div>

    <div id="presetsContainer" style="margin-top:12px;"></div>

    <p class="note">æ³¨æ„: ã“ã®ãƒšãƒ¼ã‚¸ã¯YouTubeã®åŸ‹ã‚è¾¼ã¿ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ï¼ˆIFrame Player APIï¼‰ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚åŸ‹ã‚è¾¼ã¿ãŒè¨±å¯ã•ã‚Œã¦ã„ãªã„å‹•ç”»ã¯å†ç”Ÿã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚</p>
    <p class="note">YouTube Flip Player ver.1.0.2: Copyright Â© 2025-2026 nayuki</p>
  </div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
/* ---------- çŠ¶æ…‹å¤‰æ•° ---------- */
let player = null;
let reverseInterval = null;
let pollTimer = null;
let abLoopActive = false;
let A = null, B = null;
let mirrorRequested = false; // iframeæœªç”Ÿæˆæ™‚ã®åè»¢è¦æ±‚ãƒ•ãƒ©ã‚°

/* ---------- DOM ---------- */
const urlInput = document.getElementById('urlInput');
const loadBtn = document.getElementById('loadBtn');
const unloadBtn = document.getElementById('unloadBtn');
const iframeBox = document.getElementById('iframeBox');
const playPauseBtn = document.getElementById('playPauseBtn');
const reverseBtn = document.getElementById('reverseBtn');
const mirrorBtn = document.getElementById('mirrorBtn');
const loopChk = document.getElementById('loopChk');
const speedSelect = document.getElementById('speedSelect');
const speedActive = document.getElementById('speedActive');
const posSlider = document.getElementById('posSlider');
const timeLabel = document.getElementById('timeLabel');
const pointA = document.getElementById('pointA');
const pointB = document.getElementById('pointB');
const setAFromCurrent = document.getElementById('setAFromCurrent');
const setBFromCurrent = document.getElementById('setBFromCurrent');
const setAB = document.getElementById('setAB');
const clearAB = document.getElementById('clearAB');
const presetName = document.getElementById('presetName');
const savePresetBtn = document.getElementById('savePresetBtn');
const clearPresetsBtn = document.getElementById('clearPresetsBtn');
const presetsContainer = document.getElementById('presetsContainer');

/* ---------- ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ ã‚­ãƒ¼ ---------- */
const STORAGE_KEY = 'youtubeFlipPresets';

/* ---------- ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ---------- */
function extractVideoID(input){
  if(!input) return null;
  const patterns = [
    /(?:v=|&v=)([A-Za-z0-9_-]{11})/,
    /youtu\.be\/([A-Za-z0-9_-]{11})/,
    /embed\/([A-Za-z0-9_-]{11})/,
    /^([A-Za-z0-9_-]{11})$/
  ];
  for(const p of patterns){
    const m = input.match(p);
    if(m && m[1]) return m[1];
  }
  return null;
}
function fmtTime(s){
  s = Math.max(0, Math.floor(s));
  const m = Math.floor(s/60), sec = s%60;
  return m + ':' + String(sec).padStart(2,'0');
}

// æ™‚é–“æ–‡å­—åˆ—ï¼ˆåˆ†:ç§’å½¢å¼ï¼‰ã‚’ç§’æ•°ã«å¤‰æ›
function parseTimeStr(str){
  if(!str) return null;
  str = str.trim();
  const parts = str.split(':');
  if(parts.length === 1){
    const s = parseFloat(parts[0]);
    return isNaN(s) ? null : s;
  } else if(parts.length === 2){
    const m = parseInt(parts[0], 10);
    const s = parseFloat(parts[1]);
    if(isNaN(m) || isNaN(s)) return null;
    return m * 60 + s;
  }
  return null;
}

/* ---------- Speed ã‚»ãƒ¬ã‚¯ãƒˆæ§‹ç¯‰ï¼ˆå›ºå®šãƒªã‚¹ãƒˆ & 2.5xåˆ»ã¿ã¯æ˜Ÿå°ï¼‰ ---------- */
function buildSpeedOptions() {
  const speeds = [
    0.25, 0.3, 0.4, 0.5, 0.6, 0.7, 0.75, 0.8, 0.9, 1.0,
    1.1, 1.2, 1.25, 1.3, 1.4, 1.5, 1.6, 1.7, 1.75, 1.8, 1.9, 2.0
  ];

  speedSelect.innerHTML = '';

  speeds.forEach(s => {
    const opt = document.createElement('option');
    opt.value = s.toFixed(2);   // â† â˜… å¿…ãšæ–‡å­—åˆ— "1.00" å½¢å¼ã«çµ±ä¸€
    const isQuarter = Math.abs(s * 4 - Math.round(s * 4)) < 1e-6;
    opt.textContent = isQuarter
      ? `${s.toFixed(2)}x â˜…`
      : `${s.toFixed(2)}x`;
    speedSelect.appendChild(opt);
  });

  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’ 1.00 ã«è¨­å®š
  speedSelect.value = "1.00";
  speedActive.textContent = "1.00x";
  speedActive.style.fontWeight = '900';
}
buildSpeedOptions();



/* ---------- YouTube IFrame API ---------- */
function onYouTubeIframeAPIReady(){ /* APIèª­ã¿è¾¼ã¿å®Œäº† */ }

/* ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ç”Ÿæˆ/èª­ã¿è¾¼ã¿ */
loadBtn.addEventListener('click', ()=>{
  let input = urlInput.value.trim();

  // shorts URL ã‚’ watch?v= ã«å¤‰æ›
  if (input.includes("shorts/")) {
    const id = input.split("shorts/")[1].split("?")[0];
    input = "https://www.youtube.com/watch?v=" + id;
  }

  // shorts URL ã‚’ watch?v= ã«å¤‰æ›
  if (input.includes("live/")) {
    const id = input.split("live/")[1].split("?")[0];
    input = "https://www.youtube.com/watch?v=" + id;
  }

  const id = extractVideoID(input);
  if(!id){ alert('å‹•ç”»IDãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚URLã¾ãŸã¯IDã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚'); return; }
  createOrLoadPlayer(id);
});
unloadBtn.addEventListener('click', destroyPlayer);

function createOrLoadPlayer(videoId, preset = null){
  // æ—¢å­˜ã‚’ç ´æ£„
  destroyPlayer();

  function resetControls() {
  // é€Ÿåº¦ã‚’ 1.00x ã«æˆ»ã™
  speedSelect.value = "1.00";
  speedActive.textContent = "1.00x";
  speedActive.style.fontWeight = "900";

  // å†ç”Ÿãƒœã‚¿ãƒ³è¡¨ç¤º
  playPauseBtn.textContent = "â–¶ å†ç”Ÿ";

  // é€šå¸¸ãƒ«ãƒ¼ãƒ—è§£é™¤
  loopChk.checked = false;

  // A-B è§£é™¤
  abLoopActive = false;
  A = null;
  B = null;
  pointA.value = "";
  pointB.value = "";

  // ã‚·ãƒ¼ã‚¯ä½ç½®ãƒªã‚»ãƒƒãƒˆ
  posSlider.value = 0;
  timeLabel.textContent = "0:00 / 0:00";

  // ãƒŸãƒ©ãƒ¼åè»¢è§£é™¤
  mirrorRequested = false;
  mirrorBtn.classList.remove('mirror-active');
  iframeBox.style.scale = "1";
}
  resetControls();
  
  // ãƒ—ãƒªã‚»ãƒƒãƒˆãŒã‚ã‚Œã°è¨­å®šã‚’é©ç”¨
  if(preset) {
    speedSelect.value = preset.speed;
    speedActive.textContent = preset.speed + 'x';
    const isQuarter = Math.abs(preset.speed*4 - Math.round(preset.speed*4)) < 1e-6;
    speedActive.style.fontWeight = isQuarter ? '900' : '400';
    loopChk.checked = preset.loop;
    mirrorRequested = preset.mirror;
    mirrorBtn.classList.toggle('mirror-active', mirrorRequested);
    if(preset.pointA && preset.pointB){
      pointA.value = preset.pointA;
      pointB.value = preset.pointB;
    }
  }
  
  // ã‚³ãƒ³ãƒ†ãƒŠä½œæˆ
  const div = document.createElement('div');
  div.id = 'ytplayer';
  div.style.width = '100%';
  div.style.height = '100%';
  iframeBox.appendChild(div);

  player = new YT.Player('ytplayer', {
    width: '100%', height: '100%',
    videoId: videoId,
    playerVars: { rel:0, playsinline:1, origin: window.location.origin, enablejsapi:1 },
    events: {
      onReady: (e) => {
        // speed é©ç”¨
        try{ player.setPlaybackRate(parseFloat(speedSelect.value)); }catch(e){}
        // åè»¢è¦æ±‚ãŒã‚ã‚Œã°é©ç”¨
        applyMirrorIfNeeded();
        startPoll();
      },
      onStateChange: onPlayerStateChange
    }
  });
}

function destroyPlayer(){
  stopReverseIfOn();
  if(pollTimer){ clearInterval(pollTimer); pollTimer = null; }
  if(player && typeof player.destroy === 'function'){ try{ player.destroy(); }catch(e){} }
  player = null;
  iframeBox.innerHTML = '';
  posSlider.value = 0;
  timeLabel.textContent = '0:00 / 0:00';
  abLoopActive = false; A = B = null;
}

/* ---------- å†ç”Ÿ/åœæ­¢ ---------- */
playPauseBtn.addEventListener('click', ()=>{
  if(!player) return;
  const state = player.getPlayerState ? player.getPlayerState() : -1;
  // YT.PlayerState.PLAYING === 1, PAUSED === 2
  if(state === YT && false){ /* noop to keep linter quiet */ }
  if(state === 1){ // playing -> pause
    try{ player.pauseVideo(); }catch(e){}
    playPauseBtn.textContent = 'â–¶ å†ç”Ÿ';
  } else { // otherwise play
    stopReverseIfOn();
    try{ player.playVideo(); }catch(e){}
    playPauseBtn.textContent = 'â¸ åœæ­¢';
  }
});

/* ---------- é€†å†ç”Ÿ ---------- */
reverseBtn.addEventListener('click', ()=>{
  if(!player) return;
  if(reverseInterval){ stopReverseIfOn(); return; }
  startReverse();
});

function startReverse(){
  stopReverseIfOn();
  // pause then step backwards
  try{ player.pauseVideo(); }catch(e){}
  const tickMs = 90;
  reverseInterval = setInterval(()=>{
    if(!player || typeof player.getCurrentTime !== 'function') return;
    try{
      const cur = player.getCurrentTime();
      const step = 0.08;
      const next = Math.max(0, cur - step);
      player.seekTo(next, true);
      if(next === 0) stopReverseIfOn();
    }catch(e){}
  }, tickMs);
}

function stopReverseIfOn(){
  if(reverseInterval){ clearInterval(reverseInterval); reverseInterval = null; }
}

/* ---------- é¡åƒåè»¢ãƒœã‚¿ãƒ³ ---------- */
mirrorBtn.addEventListener('click', ()=>{
  mirrorRequested = !mirrorRequested;
  mirrorBtn.classList.toggle('mirror-active', mirrorRequested);
  applyMirrorIfNeeded();
});

function applyMirrorIfNeeded(){
  // iframeBoxã«åè»¢ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©ç”¨
  const ytplayer = document.getElementById('ytplayer');
  if(mirrorRequested){
    ytplayer.style.scale = '-1 1';
  } else {
    ytplayer.style.scale = '1';
  }
}

/* ---------- é€Ÿåº¦åˆ¶å¾¡ ---------- */
speedSelect.addEventListener('change', ()=>{
  const v = parseFloat(speedSelect.value);
  speedActive.textContent = v.toFixed(2) + 'x';
  // å¼·èª¿ï¼ˆ0.25å€æ•°ã¯å¤ªå­—ã«ï¼‰
  const isQuarter = Math.abs(v*4 - Math.round(v*4)) < 1e-6;
  speedActive.style.fontWeight = isQuarter ? '900' : '400';
  if(player && typeof player.setPlaybackRate === 'function'){
    try{ player.setPlaybackRate(v); }catch(e){}
  }
});

/* ---------- ã‚·ãƒ¼ã‚¯ãƒ»ãƒãƒ¼ãƒªãƒ³ã‚° ---------- */
posSlider.addEventListener('input', ()=>{
  if(!player || typeof player.getDuration !== 'function') return;
  const pct = parseFloat(posSlider.value);
  const dur = player.getDuration() || 0;
  const t = dur * (pct/100);
  try{ player.seekTo(t, true); }catch(e){}
  updateTimeLabel(t, dur);
});

function startPoll(){
  if(pollTimer) clearInterval(pollTimer);
  pollTimer = setInterval(()=>{
    if(!player || typeof player.getDuration !== 'function') return;
    const dur = player.getDuration() || 0;
    const cur = player.getCurrentTime ? player.getCurrentTime() : 0;
    if(dur > 0) posSlider.value = (cur/dur) * 100;
    updateTimeLabel(cur, dur);
    // ABãƒ«ãƒ¼ãƒ—ç›£è¦–
    if(abLoopActive && A != null && B != null && cur > B){
      try{ player.seekTo(A, true); }catch(e){}
    }
  }, 250);
}

function updateTimeLabel(cur, dur){
  timeLabel.textContent = fmtTime(cur) + ' / ' + fmtTime(dur);
}

/* ---------- ãƒ«ãƒ¼ãƒ—ï¼ˆé€šå¸¸ï¼‰ ---------- */
loopChk.addEventListener('change', ()=>{ /* handled in onStateChange */ });

/* ---------- A-B åŒºé–“ãƒ«ãƒ¼ãƒ— ---------- */
setAFromCurrent.addEventListener('click', ()=>{
  if(!player || typeof player.getCurrentTime !== 'function') return;
  const cur = player.getCurrentTime();
  pointA.value = fmtTime(cur);
});

setBFromCurrent.addEventListener('click', ()=>{
  if(!player || typeof player.getCurrentTime !== 'function') return;
  const cur = player.getCurrentTime();
  pointB.value = fmtTime(cur);
});

setAB.addEventListener('click', ()=>{
  const a = parseTimeStr(pointA.value), b = parseTimeStr(pointB.value);
  if(a === null || b === null || a >= b){ alert('A < B ã§è¨­å®šã—ã¦ãã ã•ã„ï¼ˆå½¢å¼: åˆ†:ç§’ ä¾‹: 1:30ï¼‰'); return; }
  A = a; B = b; abLoopActive = true;
  if(player && typeof player.seekTo === 'function') try{ player.seekTo(A, true); }catch(e){}
});

clearAB.addEventListener('click', ()=>{ abLoopActive = false; A = B = null; pointA.value = ''; pointB.value = ''; });

/* ---------- ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼çŠ¶æ…‹å¤‰æ›´æ¤œçŸ¥ ---------- */
function onPlayerStateChange(e){
  // çµ‚äº†æ™‚ã®é€šå¸¸ãƒ«ãƒ¼ãƒ—
  if(e.data === YT.PlayerState.ENDED){
    if(loopChk.checked){
      if(player && typeof player.seekTo === 'function'){ try{ player.seekTo(0, true); player.playVideo(); }catch(e){} }
    } else {
      stopReverseIfOn();
      playPauseBtn.textContent = 'â–¶ å†ç”Ÿ';
    }
  }
}

/* ---------- è¨­å®šã®ä¿å­˜ãƒ»èª­ã¿è¾¼ã¿æ©Ÿèƒ½ ---------- */

// ç¾åœ¨ã®è¨­å®šã‚’å–å¾—
function getCurrentSettings(){
  return {
    videoUrl: urlInput.value.trim(),
    speed: speedSelect.value,
    loop: loopChk.checked,
    mirror: mirrorRequested,
    pointA: pointA.value || null,
    pointB: pointB.value || null,
    timestamp: new Date().toLocaleString('ja-JP')
  };
}

// ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰è¨­å®šã‚’å–å¾—
function getPresetsFromStorage(){
  const data = localStorage.getItem(STORAGE_KEY);
  return data ? JSON.parse(data) : [];
}

// è¨­å®šã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
function savePresetsToStorage(presets){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(presets));
}

// ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’ä¿å­˜
savePresetBtn.addEventListener('click', ()=>{
  const name = presetName.value.trim();
  if(!name){ alert('è¨­å®šåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }

  const settings = getCurrentSettings();
  if(!settings.videoUrl){ alert('å‹•ç”»URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }

  const presets = getPresetsFromStorage();
  
  // åŒã˜åå‰ãŒå­˜åœ¨ã™ã‚‹å ´åˆ
  const existingIndex = presets.findIndex(p => p.name === name);
  if(existingIndex >= 0){
    if(!confirm(`ã€Œ${name}ã€ã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™ã€‚ä¸Šæ›¸ãã—ã¦ã„ã„ã§ã™ã‹ï¼Ÿ`)) return;
    presets[existingIndex] = { name, ...settings };
  } else {
    presets.push({ name, ...settings });
  }

  savePresetsToStorage(presets);
  presetName.value = '';
  renderPresets();
});

// å…¨è¨­å®šã‚’å‰Šé™¤
clearPresetsBtn.addEventListener('click', ()=>{
  if(!confirm('ä¿å­˜ã—ãŸè¨­å®šã‚’å…¨ã¦å‰Šé™¤ã—ã¦ã„ã„ã§ã™ã‹ï¼Ÿ')) return;
  localStorage.removeItem(STORAGE_KEY);
  renderPresets();
});

// ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’è¡¨ç¤º
function renderPresets(){
  const presets = getPresetsFromStorage();
  presetsContainer.innerHTML = '';

  if(presets.length === 0){
    presetsContainer.innerHTML = '<p style="color:#999;font-size:12px;">ä¿å­˜ã•ã‚ŒãŸè¨­å®šãŒã‚ã‚Šã¾ã›ã‚“</p>';
    return;
  }

  const title = document.createElement('div');
  title.style.fontWeight = 'bold';
  title.style.marginBottom = '8px';
  title.textContent = `ä¿å­˜æ¸ˆã¿è¨­å®š (${presets.length})`;
  presetsContainer.appendChild(title);

  presets.forEach((preset, index)=>{
    const item = document.createElement('div');
    item.className = 'preset-item';

    const info = document.createElement('div');
    info.className = 'preset-info';

    const titleDiv = document.createElement('div');
    titleDiv.className = 'preset-info-title';
    titleDiv.textContent = preset.name;
    info.appendChild(titleDiv);

    const details = document.createElement('div');
    details.className = 'preset-info-details';
    let detailText = `é€Ÿåº¦: ${preset.speed}x | ãƒ«ãƒ¼ãƒ—: ${preset.loop ? 'ON' : 'OFF'} | åè»¢: ${preset.mirror ? 'ON' : 'OFF'}`;
    if(preset.pointA && preset.pointB){
      detailText += ` | åŒºé–“: ${preset.pointA}-${preset.pointB}`;
    }
    if(preset.timestamp){
      detailText += ` | ${preset.timestamp}`;
    }
    details.textContent = detailText;
    info.appendChild(details);
    item.appendChild(info);

    const actions = document.createElement('div');
    actions.className = 'preset-actions';

    const loadBtn = document.createElement('button');
    loadBtn.textContent = 'ğŸ“‚ èª­è¾¼';
    loadBtn.addEventListener('click', ()=>{ loadPreset(preset); });
    actions.appendChild(loadBtn);

    const delBtn = document.createElement('button');
    delBtn.textContent = 'âŒ å‰Šé™¤';
    delBtn.addEventListener('click', ()=>{
      if(!confirm(`ã€Œ${preset.name}ã€ã‚’å‰Šé™¤ã—ã¦ã„ã„ã§ã™ã‹ï¼Ÿ`)) return;
      const allPresets = getPresetsFromStorage();
      allPresets.splice(index, 1);
      savePresetsToStorage(allPresets);
      renderPresets();
    });
    actions.appendChild(delBtn);

    item.appendChild(actions);
    presetsContainer.appendChild(item);
  });
}

// ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’èª­ã¿è¾¼ã‚€
function loadPreset(preset){
  urlInput.value = preset.videoUrl;
  // å‹•ç”»ã‚’èª­ã¿è¾¼ã‚€
  const id = extractVideoID(preset.videoUrl);
  if(id){
    destroyPlayer();
    createOrLoadPlayer(id, preset);
  }
}

// åˆæœŸè¡¨ç¤º
renderPresets();

/* ---------- ãƒ˜ãƒ«ãƒ‘ãƒ¼ ---------- */
function fmtTime(s){ s = Math.max(0, Math.floor(s)); const m = Math.floor(s/60); const sec = s%60; return m+':'+String(sec).padStart(2,'0'); }

/* å…¨ç”»é¢çŠ¶æ…‹å¤‰æ›´æ™‚ã«åè»¢ã‚’ç¶­æŒ */
document.addEventListener('fullscreenchange', ()=>{ applyMirrorIfNeeded(); });

/* Cleanup on unload */
window.addEventListener('beforeunload', ()=>{ destroyPlayer(); });

</script>
</body>
</html>
